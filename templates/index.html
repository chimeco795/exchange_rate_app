<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exchange Rate List</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
</head>
<body>
    <div class="container my-5">
        <h1 class="mb-4">Exchange Rate List</h1>
        <div class="info-section">
            <p><strong>Archivo:</strong> {{ file_name }}</p>
            <p><strong>Última modificación:</strong> {{ modification_time }}</p>
        </div>
        <div class="floating-controls" id="floating-controls">
            <button type="button" class="btn btn-primary mb-2" id="save-btn" data-bs-toggle="tooltip" data-bs-placement="left" title="Guardar">
                <i class="fas fa-save"></i> <span class="btn-text">Guardar</span>
            </button>
            <button type="button" class="btn btn-secondary mb-2" id="refresh-btn" data-bs-toggle="tooltip" data-bs-placement="left" title="Actualizar">
                <i class="fas fa-sync-alt"></i> <span class="btn-text">Actualizar</span>
            </button>
            <button type="reset" class="btn btn-warning mb-2" id="cancel-btn" data-bs-toggle="tooltip" data-bs-placement="left" title="Cancelar">
                <i class="fas fa-times"></i> <span class="btn-text">Cancelar</span>
            </button>
        </div>
        <div class="search-container">
            <input type="text" id="search-input" class="form-control search-input" placeholder="Buscar por país o moneda...">
            <span id="clear-search" class="clear-search">&times;</span>
        </div>
        <form id="exchange-form">
            <table class="table table-striped table-hover" id="exchange-table">
                <thead>
                    <tr>
                        <th><span class="sortable-header" id="sort-country">Moneda (País) <i class="fas fa-sort-alpha-up"></i></span></th>
                        <th><span class="sortable-header" id="sort-value">Valor <i class="fas fa-sort-numeric-up"></i></span></th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in data %}
                    <tr>
                        <td>
                            <img src="https://flagcdn.com/32x24/{{ item.moneda[:2].lower() }}.png" alt="{{ item.moneda }}" class="flag" data-country="{{ item.moneda[:2].lower() }}" style="margin-right: 10px;">
                            {{ item.moneda }}
                        </td>
                        <td>
                            <input type="text" class="form-control currency-input" name="valor" data-moneda="{{ item.moneda }}" value="{{ item.valor }}" placeholder="0.00000" pattern="^\d{0,3}(\\.\\d{0,5})?$" title="Ingrese un número válido con hasta 3 enteros y 5 decimales">
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </form>
    </div>

    <div id="toast-container" class="toast-container"></div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/scripts.js') }}"></script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('{{ url_for('static', filename='service-worker.js') }}')
            .then(function(registration) {
                console.log('ServiceWorker registration successful with scope: ', registration.scope);
            }, function(err) {
                console.log('ServiceWorker registration failed: ', err);
            });
        }
    </script>
</body>
</html>
